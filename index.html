<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R_Rolls</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* モバイル最適化用の追加スタイル */
        @media (max-width: 768px) {
            /* 画面全体の高さを確保し、はみ出しを禁止 */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0 !important; /* bodyのpaddingをなくす */
                overflow: hidden; /* 全体スクロールを無効化 */
            }

            .container {
                height: 100%;
                display: flex;
                flex-direction: column;
                padding: 4px; /* コンテナ側で少し余白を取る */
                box-sizing: border-box;
            }

            /* ヘッダーとコントロールエリアは高さを固定（縮小させない） */
            .header-row, 
            .controls, 
            .description-box, 
            #result,
            .forecast-summary-container { /* Find表示エリアも含める */
                flex-shrink: 0;
            }

            .header-row {
                flex-direction: row !important; /* 横並びを強制 */
                flex-wrap: wrap;
                align-items: center;
                gap: 5px;
                padding-bottom: 5px;
                border-bottom: 1px solid #eee;
                margin-bottom: 5px;
            }

            h1 {
                font-size: 16px !important;
                margin-right: 5px;
            }

            .header-actions {
                display: flex;
                gap: 3px;
                flex-wrap: wrap;
            }

            .header-actions button, 
            .header-actions span {
                font-size: 10px !important;
                padding: 2px 6px !important;
                height: 24px;
                line-height: 20px;
            }

            /* SEED入力欄のポップアップ調整 */
            #seed-input-container {
                position: absolute;
                top: 40px;
                left: 10px;
                background: white;
                padding: 5px;
                border: 1px solid #ccc;
                z-index: 100;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }

            /* テーブルコンテナを残りの領域いっぱいに広げる */
            #rolls-table-container {
                flex-grow: 1;
                max-height: none !important; /* 既存の制限を解除 */
                margin-bottom: 0 !important;
                overflow-y: auto; /* 縦スクロール許可 */
                border-bottom: none; /* 下のボーダーを画面端に合わせる */
            }
            
            /* スケジュール表示時も同様に */
            #schedule-container {
                flex-grow: 1;
                overflow-y: auto;
                padding-bottom: 0;
            }
            .schedule-scroll-wrapper {
                max-height: none !important;
            }
        }

        /* デスクトップ用 */
        .header-actions button {
            padding: 4px 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-row">
            <h1>R_Rolls</h1>
            <div class="header-actions">
                <span id="seed-input-trigger" class="text-btn" onclick="showSeedInput()">SEED</span>
                
                <span id="seed-input-container" class="hidden">
                    <label for="seed" style="font-size:0.8em;">Seed:</label>
                    <input type="number" id="seed" placeholder="Seed" value="12345" style="width:80px; font-size:0.9em;" onkeydown="if(event.key==='Enter') applySeedInput()">
                    <button onclick="applySeedInput()" style="padding: 1px 6px; font-size: 10px;">OK</button>
                </span>

                <span class="separator">|</span>
                <span id="toggle-find-info-btn" class="text-btn" onclick="toggleFindInfo()">Find</span>
                
                <span class="separator">|</span>
                <span id="toggle-description" class="text-btn" onclick="toggleDescription()">概要</span>
                
                <span class="separator">|</span>
                <span id="mode-toggle-btn" class="text-btn" onclick="toggleAppMode()">Sim</span>
                
                <span class="separator">|</span>
                <span id="toggle-schedule-btn" class="text-btn" onclick="toggleSchedule()">skd</span>
            </div>
        </div>

        <div id="description-content" class="description-box hidden">
            <p><strong>Seed:</strong> ガチャの初期シード値（開始前シード値）を入力してください。<br>
            <strong>Simulation Config:</strong> ガチャ手順「ガチャID ロール数」(例: 1006 4 942 11g)。数値のみは単発、+gは確定。</p>
        </div>
        
        <div id="main-controls" class="controls" style="display: flex; flex-wrap: wrap; align-items: center; gap: 10px; padding: 5px; margin-bottom: 5px;">
            
            <div class="control-group hidden" id="sim-control-wrapper" style="margin-bottom: 0; display: flex; align-items: center; width: 100%;">
                <label for="sim-config" style="font-size:0.9em;">Config:</label>
                <input type="text" id="sim-config" placeholder="e.g. 1006 4 942 11g" onchange="updateUrlParams(); resetAndGenerateTable();" style="flex-grow: 1;">
                <button onclick="clearSimConfig()" style="margin-left: 5px; font-size: 11px;">Clear</button>
            </div>
        </div>

        <div id="result" class="result-box hidden" style="font-size: 10px; margin-bottom: 2px;"></div>
        
        <div id="rolls-table-container"></div>

        <div id="schedule-container" class="hidden"></div>
    </div>

    <script src="cats.js"></script>
    <script src="gacha_series.js"></script>
    <script src="limited_cats.js"></script>
    <script src="logic.js"></script>
    <script src="simulation.js"></script>
    <script src="schedule_logic.js"></script>
    <script src="data_loader.js"></script> 
    <script src="url_manager.js"></script>
    <script src="gacha_selector.js"></script>
    <script src="view_forecast.js"></script>
    <script src="view_master.js"></script>
    <script src="view_table.js"></script>
    <script src="ui_controller.js"></script>
    <script src="main.js"></script>
</body>
</html>