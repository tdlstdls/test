<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.3, maximum-scale=3.0, user-scalable=yes">
    <title>R_Rolls</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @media (max-width: 768px) {
            html, body { height: 100%; margin: 0; padding: 0 !important; overflow: hidden; }
            .container { height: 100%; display: flex; flex-direction: column; padding: 4px; box-sizing: border-box; }
            .header-row, .controls, .description-box, #result, .forecast-summary-container { flex-shrink: 0; }
            .header-row { flex-direction: row !important; flex-wrap: nowrap !important; overflow-x: auto; align-items: center; padding-bottom: 5px; border-bottom: 1px solid #eee; margin-bottom: 5px; white-space: nowrap; }
            h1 { font-size: 16px !important; margin-right: 5px; }
            .header-actions { display: flex; gap: 3px; flex-wrap: wrap; }
            .header-actions button, .header-actions span { font-size: 10px !important; padding: 2px 6px !important; height: 24px; line-height: 20px; }
            #rolls-table-container { flex-grow: 1; max-height: none !important; margin-bottom: 0 !important; overflow-y: auto; border-bottom: none; }
            #schedule-container { flex-grow: 1; overflow-y: auto; padding-bottom: 0; }
            .schedule-scroll-wrapper { max-height: none !important; }
        }
        .header-actions button { padding: 4px 8px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-row">
            <h1>R_Rolls</h1>
            <div class="header-actions">
                <span id="seed-input-trigger" class="text-btn" onclick="toggleSeedInput()">SEED</span>
                <span class="separator">|</span>
                <span id="toggle-find-info-btn" class="text-btn" onclick="toggleFindInfo()">Find</span>
                <span class="separator">|</span>
                <span id="mode-toggle-btn" class="text-btn" onclick="toggleAppMode()">Sim</span>
                <span class="separator">|</span>
                <span id="toggle-schedule-btn" class="text-btn" onclick="toggleSchedule()">skd</span>
                <span class="separator">|</span>
                <span id="toggle-description" class="text-btn" onclick="toggleDescription()">概要</span>
            </div>
        </div>
        <div id="description-content" class="description-box hidden" style="font-size: 0.8em;">
            <h3 style="margin-top:0;">【ツール概要】</h3>
            <p style="margin-bottom:10px;">レアガチャの排出結果を予測・シミュレーションするツールです。<br>各ガチャの排出キャラの確認や、確定枠等を利用したルート取りを支援します。</p>
            <h3 style="margin-top:0;">【基本操作】</h3>
            <ul style="padding-left: 20px; margin-bottom:10px;">
                <li><strong>SEED設定:</strong> SEEDを押し、実行前シードを入力してください。</li>
                <li><strong>ガチャ選択:</strong> 表のヘッダー下部のプルダウンから、表示したいガチャを選択できます。</li>
                <li><strong>列の追加・削除:</strong> 「＋列を追加」ボタンで比較用の列を増やせます。「skdで追加」を押すと、スケジュール一覧のガチャを一括で追加します。</li>
            </ul>
            <h3 style="margin-top:0;">【主要機能】</h3>
            <dl style="margin-bottom:10px;">
                <dt><strong>1. Find</strong></dt>
                <dd style="margin-bottom:5px;">2000ロール先までの「伝説枠」等を検索して表示します。リスト内のキャラ名をクリックすると、そのキャラを「Find」ターゲットとして登録/解除できます。</dd>
                <dt><strong>2. Sim (シミュレーションモード)</strong></dt>
                <dd style="margin-bottom:5px;">複数のガチャを跨いで引いた場合の結果をシミュレーションします。<br>「ルート」欄に形式に従って入力してください。また、Simモードでテーブル上のキャラ名をタップ（クリック）すると、そこまでのルートを自動計算します。自動計算では、超激確定・プラチナ・レジェンドは消費を避けるため使用しません。</dd>
                <dt><strong>3. skd (スケジュール)</strong></dt>
                <dd>「skd」ボタンで、直近のガチャ開催スケジュールを確認できます。</dd>
            </dl>
        </div>
        <div id="main-controls" class="controls" style="display: flex; flex-wrap: wrap; align-items: center; gap: 10px; padding: 5px; margin-bottom: 5px;">
            <div id="seed-input-container" class="control-group hidden" style="margin-bottom: 0; display: flex; align-items: center; gap: 5px;">
                <label for="seed" style="font-size:0.9em;">Seed:</label>
                <input type="number" id="seed" placeholder="Seed" value="12345" style="width:100px; font-size:0.9em;" onkeydown="if(event.key==='Enter') applySeedInput()">
                <button onclick="applySeedInput()" style="padding: 1px 6px; font-size: 11px;">OK</button>
                <button onclick="copySeedToClipboard()" class="secondary" style="padding: 1px 6px; font-size: 11px;">Copy</button>
                <button onclick="cancelSeedInput()" class="secondary" style="padding: 1px 6px; font-size: 11px;">×</button>
            </div>
            <div class="control-group hidden" id="sim-control-wrapper" style="margin-bottom: 0; display: flex; align-items: center; flex-wrap: wrap; width: 100%;">
                <div style="display: flex; align-items: center; width: 100%; gap: 5px;">
                    <label for="sim-config" style="font-size:0.9em;">ルート:</label>
                    <input type="text" id="sim-config" placeholder="e.g. 1006 4 942 11g" onchange="updateUrlParams(); resetAndGenerateTable();" style="flex-grow: 1;">
                    <button onclick="backSimConfig()" style="font-size: 11px; min-width: 40px;">Back</button>
                    <button onclick="clearSimConfig()" style="font-size: 11px;">Clear</button>
                    <button id="toggle-txt-btn" onclick="toggleTxtMode()" style="font-size: 11px;">Txt</button>
                    <button id="copy-txt-btn" onclick="copyTxtToClipboard()" class="hidden" style="margin-left: 2px; font-size: 11px;">Copy</button>
                    <span id="sim-notif-msg" style="color: #28a745; font-size: 0.8em; margin-left: 5px; font-weight: bold; display: none;"></span>
                    <div id="sim-error-msg" style="color: #d9534f; font-size: 0.85em; margin-left: 5px; display: none;"></div>
                </div>
            </div>
        </div>
        <div id="result" class="result-box hidden" style="font-size: 10px; margin-bottom: 2px;"></div>
        <div id="rolls-table-container"></div>
        <div id="schedule-container" class="hidden"></div>
    </div>
    <script src="cats.js"></script>
    <script src="gacha_series.js"></script>
    <script src="limited_cats.js"></script>
    <script src="logic.js"></script>
    <script src="sim_config_helpers.js"></script>
    <script src="sim_utils.js"></script>
    <script src="sim_engine.js"></script>
    <script src="sim_ui_logic.js"></script>
    <script src="schedule_logic.js"></script>
    <script src="view_schedule_utils.js"></script>
    <script src="view_schedule_gantt.js"></script>
    <script src="view_schedule_table.js"></script>
    <script src="data_loader.js"></script>
    <script src="url_manager.js"></script>
    <script src="gacha_selector.js"></script>
    <script src="view_schedule_editor.js"></script>
    <script src="ui_schedule_editor_handler.js"></script>
    <script src="view_forecast.js"></script>
    <script src="view_master.js"></script>
    <script src="view_analysis.js"></script>
    <script src="view_header.js"></script>
    <script src="view_cell_renderer.js"></script>
    <script src="view_table_data.js"></script>
    <script src="view_table_highlight.js"></script>
    <script src="view_table.js"></script>
    <script src="ui_globals.js"></script>
    <script src="ui_schedule_handler.js"></script>
    <script src="ui_target_handler.js"></script>
    <script src="ui_table_handler.js"></script>
    <script src="ui_mode_logic.js"></script>
    <script src="ui_seed_logic.js"></script>
    <script src="ui_refresh_logic.js"></script>
    <script src="ui_display_logic.js"></script>
    <script src="ui_cell_event.js"></script>
    <script src="main.js"></script>
</body>
</html>